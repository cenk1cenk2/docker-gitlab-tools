[
  {
    "name": "config",
    "templates": [
      {
        "input": "/etc/gitlab-tools/config.tpl",
        "output": "/etc/gitlab-tools/config.yml",
        "chown": {
          "user": "service"
        }
      }
    ]
  },
  {
    "name": "permissions",
    "permissions": [
      {
        "path": "/home/service",
        "chown": {
          "user": "service"
        },
        "chmod": {
          "file": "0640",
          "dir": "2700"
        },
        "recursive": true
      },
      {
        "path": "/home/service/.ssh",
        "chown": {
          "user": "service"
        },
        "chmod": {
          "file": "0640",
          "dir": "2700"
        },
        "recursive": true
      }
    ]
  },
  {
    "commands": [
      {
        "name": "migrations",
        "command": "/etc/cont-init.d/00-migrate-database.sh"
      }
    ]
  },
  {
    "commands": [
      {
        "name": "nginx",
        "command": "service nginx start"
      }
    ],
    "background": true
  },
  {
    "parallel": true,
    "commands": [
      {
        "name": "celerybeat",
        "cwd": "/opt/gitlab-tools",
        "command": "/etc/services.d/gitlab-tools-bgtask/service.sh",
        "run_as": {
          "user": "service"
        },
        "ensure_is_alive": true
      },
      {
        "name": "celeryworker",
        "cwd": "/opt/gitlab-tools",
        "command": "/etc/services.d/gitlab-tools-worker/service.sh",
        "run_as": {
          "user": "service"
        },
        "ensure_is_alive": true
      },
      {
        "name": "uwsgi",
        "cwd": "/opt/gitlab-tools",
        "command": "/etc/services.d/uwsgi/service.sh",
        "run_as": {
          "user": "service"
        },
        "ensure_is_alive": true
      }
    ]
  }
]
